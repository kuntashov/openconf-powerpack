1. строка 140 
	$first_code = $i if not $first_code; 
заменена на 
	$first_code = $i if $first_code < 0; 
причина очевидна

2. использование несуществующего в perl ключевого слова "break" для
преждевременного выхода из циклов, заменено на ключевое слово "last"

3. обращения к элементам массива по индексу вида @arr[$ix] заменены
повсеместно на $arr[$i]